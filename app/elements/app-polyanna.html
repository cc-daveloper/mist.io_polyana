<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="../../bower_components/paper-styles/typography.html">


<dom-module id="app-polyanna">
    <template>
      <style>
        :host{
          text-align: center;
          color: #000000;
        }
       #panel1{
           width: 150px;
           margin-left: 68px;
           float: left;
           font-weight: bold;
       }
       #panel2{
           display: block;
           margin-right: 68px;
           float: right;
           font-weight: bold;
       }
      </style>
      <h2 id="show" style="display:none;">Hello!1!</h2>
        <template is="dom-repeat" items="[[rows]]">
          <row-element datasources="[[datasources]]" height="[[rowheight(index)]]" title="[[_fillrow1(index)]]" row="[[thisRow(index)]]"></row-element>
         </template>
        <br></br>
        <!--<chart-bar>hello</chart-bar>-->
        <br></br>
      <iron-ajax
      auto
      url="http://localhost:5000/api/dashboards/db/mydashboard"
      headers='{"Authorization": "Bearer eyJrIjoiTDdKaHdKNjJFT05nWU81dHlnYVVkbGdiUmVIY1lYUWkiLCJuIjoibXlrZXkiLCJpZCI6Mn0="}'
      handle-as="json"
      method="GET"
      on-response="_handleResponse"
      debounce-duration="300"
    ></iron-ajax>
    <iron-ajax
      auto
      url="http://localhost:5000/api/datasources"
      headers='{"Authorization": "Bearer eyJrIjoiTDdKaHdKNjJFT05nWU81dHlnYVVkbGdiUmVIY1lYUWkiLCJuIjoibXlrZXkiLCJpZCI6Mn0="}'
      handle-as="json"
      method="GET"
      on-response="_saveDatasources"
      debounce-duration="50"
    ></iron-ajax>
    </template>
    <script>

        Polymer({
          is: 'app-polyanna',

          properties: {
            response: Object,
            rows: {type:Array, value: []},
            test: {type:String, value: 'test'},
            datasources: Array,
            // rows:
          },
          _saveDatasources:function(data){
            this.datasources=data.detail.response;
            console.log(data.detail.response);
            console.log(this.datasources);
          },
          _handleResponse:function(data){
            this.$.show.textContent = data.detail.response;
            this.response = data.detail.response;
            /*this._fillrow1();*/
            this.makeRows();
          },
          _fillrow1: function(index){
            var node = this.response.dashboard.rows[index].panels.title;
            this.title= node;
            return  node;
            //alert(1);
          },
          rowheight: function(index){
            if(this.rows){
              return this.rows[index].height;
            }
          },
          makeRows: function() {
            this.rows = this.response.dashboard.rows;
          },
          thisRow: function(index){
            return this.response.dashboard.rows[index]
          },
          translateResponse: function() {
            for (var prop in this.responce) {

            }
          }
      });

    </script>
</dom-module>
